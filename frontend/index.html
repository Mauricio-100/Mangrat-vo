<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mangrat Frontend</title>
<style>
/* ===== Reset & Base ===== */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: #121212; color: #fff; display: flex; flex-direction: column; min-height: 100vh; }

/* ===== Container ===== */
#app { flex: 1; max-width: 500px; margin: 1rem auto; background: #1f1f1f; border-radius: 10px; overflow: hidden; display: flex; flex-direction: column; }

/* ===== Header ===== */
#app h2 { text-align: center; padding: 1rem; background: #2c2c2c; font-size: 1.5rem; }

/* ===== Chat Log ===== */
#chatLog { flex: 1; padding: 1rem; overflow-y: auto; background: #111; }
.message { margin: 0.5rem 0; max-width: 80%; padding: 0.5rem 0.8rem; border-radius: 20px; word-wrap: break-word; animation: fadeIn 0.3s; }
.user { background: #4caf50; color: #fff; align-self: flex-end; }
.bot { background: #f1c40f; color: #121212; align-self: flex-start; }

/* ===== Input & Buttons ===== */
.input-container { display: flex; padding: 0.5rem; background: #1e1e1e; }
input { flex: 1; padding: 0.8rem; border-radius: 20px; border: none; font-size: 1rem; margin-right: 0.5rem; }
input:focus { outline: none; }
button { padding: 0.8rem 1.2rem; border: none; border-radius: 20px; background: #4caf50; color: #fff; cursor: pointer; transition: 0.2s; }
button:hover { background: #45a049; }

/* ===== Conversion ===== */
#conversion { display: flex; flex-direction: column; padding: 0.5rem 1rem; background: #1e1e1e; }
#conversion input { margin-bottom: 0.5rem; }
#conversionResult { margin-top: 0.5rem; color: #f39c12; }

/* ===== Footer ===== */
footer { text-align: center; padding: 0.8rem; background: #2c2c2c; font-size: 0.9rem; }

/* ===== Animations ===== */
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* ===== Responsive ===== */
@media (max-width: 600px) {
    #app { margin: 0.5rem; }
    #chatLog { height: 250px; }
    input, button { font-size: 0.95rem; }
}
</style>
</head>
<body>

<div id="app">
  <h2>Mangrat AI Chat</h2>
  
  <div id="chatLog"></div>
  
  <div class="input-container">
    <input type="text" id="chatInput" placeholder="Tape ton message..." />
    <button onclick="sendChat()">Envoyer</button>
  </div>

  <div id="conversion">
    <input type="number" id="usdAmount" placeholder="Montant USD" />
    <button onclick="convertUSD()">Convertir en tokens</button>
    <div id="conversionResult"></div>
  </div>
</div>

<footer>Créé par Mauricio Mangituka 2025 ✨</footer>

<script>
// ----- Ton token qui sert de "connexion" -----
const token = "sk-6ec147262d78ceba829992d2f8a144c0e6835b4a5ada98de";

// ----- URL interne cachée (non visible à l’utilisateur) -----
const _serverURL = "https://sarver-fullstack-4.onrender.com";

// ----- Chat -----
async function sendChat() {
  const input = document.getElementById("chatInput");
  const message = input.value.trim();
  if (!message) return;

  appendMessage("user", message);
  input.value = "";

  try {
    const res = await fetch(_serverURL + "/chat", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ message })
    });
    const data = await res.json();
    appendMessage("bot", Array.isArray(data.reply) ? data.reply.join("\n") : data.reply || "Pas de réponse.");
  } catch (e) {
    appendMessage("bot", "Erreur serveur.");
    console.error(e);
  }
}

function appendMessage(sender, text) {
  const chatLog = document.getElementById("chatLog");
  const div = document.createElement("div");
  div.className = "message " + sender;
  div.textContent = sender === "user" ? "Vous: " + text : "Mangrat: " + text;
  chatLog.appendChild(div);
  chatLog.scrollTop = chatLog.scrollHeight;
}

// ----- Conversion USD → tokens -----
async function convertUSD() {
  const amount = document.getElementById("usdAmount").value;
  if (!amount) return;

  try {
    const res = await fetch(_serverURL + "/user/convert", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({ from: "USD", to: "tokens", amount: parseFloat(amount) })
    });
    const data = await res.json();
    document.getElementById("conversionResult").textContent = `Résultat: ${data.converted || "Erreur"} tokens`;
  } catch (e) {
    document.getElementById("conversionResult").textContent = "Erreur serveur.";
    console.error(e);
  }
}

// Envoi avec Enter
document.getElementById("chatInput").addEventListener("keydown", e => {
  if (e.key === "Enter") sendChat();
});
</script>

</body>
</html>
