<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mangrat AI Chat</title>
<style>
    /* ===== Reset & Base ===== */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background-color: #f5f6fa; color: #333; display: flex; flex-direction: column; min-height: 100vh; }
    a { text-decoration: none; color: inherit; }

    /* ===== Header ===== */
    header { background-color: #2f3640; color: #fff; padding: 1rem 2rem; text-align: center; font-size: 1.5rem; font-weight: bold; }

    /* ===== Chat Container ===== */
    .chat-container { flex: 1; display: flex; flex-direction: column; max-width: 800px; margin: 2rem auto; background-color: #fff; border-radius: 10px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); overflow: hidden; }
    .messages { flex: 1; padding: 1rem; overflow-y: auto; }
    .message { margin-bottom: 1rem; display: flex; flex-wrap: wrap; }
    .message.user { justify-content: flex-end; }
    .message.user .bubble { background-color: #4cd137; color: #fff; }
    .message.ai { justify-content: flex-start; }
    .message.ai .bubble { background-color: #dcdde1; color: #2f3640; }

    .bubble { padding: 0.7rem 1rem; border-radius: 20px; max-width: 70%; word-wrap: break-word; }

    /* ===== Input ===== */
    .input-container { display: flex; border-top: 1px solid #dcdde1; }
    input { flex: 1; padding: 1rem; border: none; font-size: 1rem; }
    input:focus { outline: none; }
    button { padding: 1rem 1.5rem; border: none; background-color: #273c75; color: #fff; font-weight: bold; cursor: pointer; transition: 0.2s; }
    button:hover { background-color: #192a56; }

    /* ===== Footer ===== */
    footer { background-color: #2f3640; color: #fff; text-align: center; padding: 1rem 2rem; font-size: 0.9rem; }

    /* ===== Scrollbar ===== */
    .messages::-webkit-scrollbar { width: 8px; }
    .messages::-webkit-scrollbar-thumb { background: #718093; border-radius: 4px; }
    .messages::-webkit-scrollbar-track { background: #f5f6fa; }
    
    /* ===== Responsive ===== */
    @media (max-width: 600px) {
        .chat-container { margin: 1rem; }
        .bubble { max-width: 85%; }
        button { padding: 0.8rem 1rem; font-size: 0.9rem; }
    }
</style>
</head>
<body>

<header>Mangrat AI Chat</header>

<div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Écris ton message ici...">
        <button id="sendBtn">Envoyer</button>
    </div>
</div>

<footer>Créé par Mauricio Mangituka 2025 ✨</footer>

<script>
const messagesEl = document.getElementById("messages");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");

// Remplace par ton token API Mangrat
const API_TOKEN = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NywiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiaWF0IjoxNzU3OTgxNTc1LCJleHAiOjE3NTg1ODYzNzV9.RCH83gMFr3yJgkGyYLO6DhRuLtzaeITu9UkNIM6yZms";

async function sendMessage(message) {
    // Affiche le message utilisateur
    appendMessage("user", message);

    try {
        const res = await fetch("/chat", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${API_TOKEN}`
            },
            body: JSON.stringify({ message })
        });

        const data = await res.json();
        appendMessage("ai", data.reply || "Erreur du serveur.");
    } catch (err) {
        appendMessage("ai", "Erreur de connexion.");
    }
}

function appendMessage(sender, text) {
    const msgEl = document.createElement("div");
    msgEl.classList.add("message", sender);
    const bubble = document.createElement("div");
    bubble.classList.add("bubble");
    bubble.textContent = text;
    msgEl.appendChild(bubble);
    messagesEl.appendChild(msgEl);
    messagesEl.scrollTop = messagesEl.scrollHeight;
}

sendBtn.addEventListener("click", () => {
    const msg = messageInput.value.trim();
    if (!msg) return;
    sendMessage(msg);
    messageInput.value = "";
});

messageInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") sendBtn.click();
});
</script>

</body>
</html>
